<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI êµì‚¬ ë³´ì¡° ë„êµ¬ (í‰ì–´ & í–‰ë°œ)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles -->
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f3f4f6; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
        .checkbox-wrapper input:checked + div {
            background-color: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ë°ì´í„° ì •ì˜ (ì´ë¯¸ì§€ ê¸°ë°˜) ---
        const BEHAVIOR_CATEGORIES = {
            "í•™ìŠµ": ["í•™ìŠµ(ìš°ìˆ˜)", "í•™ìŠµ(ë°œì „ê°€ëŠ¥)", "í•™ìŠµ(ì œì•ˆ)"],
            "ì„±ê²©": ["ëˆê¸°", "ì˜ˆì˜", "ë°°ë ¤", "ë…ì„œ", "êµìš°ê´€ê³„", "ê·œì¹™ì¤€ìˆ˜", "ì†Œì‹ ", "ë´‰ì‚¬", "ê°ˆë“±ê´€ë¦¬", "ì±…ì„ê°", "ë°œí‘œ", "í˜‘ë ¥", "ìœ ë¨¸"],
            "ì˜ˆì²´ëŠ¥": ["ìŒì•…", "ë¯¸ìˆ ", "ì²´ìœ¡"]
        };

        const App = () => {
            // --- Common State ---
            const [mode, setMode] = useState('comment'); // 'comment' | 'behavior'
            const [apiKey, setApiKey] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            // --- Comment Gen State ---
            const [standards, setStandards] = useState(['']);
            const [counts, setCounts] = useState({ veryGood: 3, good: 3, average: 3, needsEffort: 3 });
            const [commentResults, setCommentResults] = useState(null);
            const [activeTab, setActiveTab] = useState(0);

            // --- Behavior Gen State ---
            const [studentCount, setStudentCount] = useState(1);
            const [students, setStudents] = useState([{ id: 1, name: '', checks: new Set() }]);
            const [targetBytes, setTargetBytes] = useState(500); // ëª©í‘œ ë°”ì´íŠ¸ ìˆ˜
            const [behaviorResults, setBehaviorResults] = useState(null);

            // --- Helpers ---
            const copyToClipboard = (text) => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            };

            // --- Logic: Comment Generator ---
            const addStandard = () => setStandards([...standards, '']);
            const removeStandard = (idx) => {
                const newStds = standards.filter((_, i) => i !== idx);
                setStandards(newStds.length ? newStds : ['']);
            };
            const handleStandardChange = (idx, val) => {
                const newStds = [...standards];
                newStds[idx] = val;
                setStandards(newStds);
            };
            const handleCountChange = (level, val) => {
                let num = parseInt(val) || 0;
                setCounts({ ...counts, [level]: Math.min(40, Math.max(0, num)) });
            };

            // --- Logic: Behavior Generator ---
            const handleStudentCountChange = (e) => {
                const count = Math.max(1, Math.min(50, parseInt(e.target.value) || 1));
                setStudentCount(count);
                
                // ê¸°ì¡´ ë°ì´í„° ìœ ì§€í•˜ë©´ì„œ ë°°ì—´ í¬ê¸° ì¡°ì ˆ
                setStudents(prev => {
                    const newArr = [...prev];
                    if (count > prev.length) {
                        for (let i = prev.length; i < count; i++) {
                            newArr.push({ id: i + 1, name: '', checks: new Set() });
                        }
                    } else {
                        return newArr.slice(0, count);
                    }
                    return newArr;
                });
            };

            const toggleCheck = (studentIndex, trait) => {
                setStudents(prev => {
                    const newArr = [...prev];
                    const student = { ...newArr[studentIndex] };
                    const newChecks = new Set(student.checks);
                    if (newChecks.has(trait)) {
                        newChecks.delete(trait);
                    } else {
                        newChecks.add(trait);
                    }
                    student.checks = newChecks;
                    newArr[studentIndex] = student;
                    return newArr;
                });
            };

            const updateStudentName = (idx, val) => {
                setStudents(prev => {
                    const newArr = [...prev];
                    newArr[idx] = { ...newArr[idx], name: val };
                    return newArr;
                });
            };

            // --- API Call Functions ---

            const callGemini = async (prompt) => {
                if (!apiKey) throw new Error('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                
                // ëª¨ë¸ëª… ë³€ê²½: gemini-1.5-flash -> gemini-1.5-flash-002 (ì•ˆì • ë²„ì „ ì‚¬ìš©)
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-002:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        safetySettings: [
                            { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                        ],
                        generationConfig: {
                            temperature: 0.9,
                            maxOutputTokens: 8192,
                            responseMimeType: "application/json"
                        }
                    })
                });

                if (!response.ok) {
                    const errData = await response.json().catch(() => ({}));
                    throw new Error(errData.error?.message || `ì„œë²„ ì˜¤ë¥˜ (${response.status}) - ëª¨ë¸ëª…ì´ë‚˜ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                }

                const data = await response.json();
                const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!rawText) throw new Error('AI ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');

                return JSON.parse(rawText);
            };

            // 1. í‰ì–´ ìƒì„± í•¨ìˆ˜
            const generateComments = async () => {
                const validStandards = standards.filter(s => s.trim() !== '');
                if (validStandards.length === 0) {
                    setError('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì„±ì·¨ ê¸°ì¤€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                setLoading(true);
                setError('');
                setCommentResults(null);

                try {
                    const prompt = `
                        ë‹¹ì‹ ì€ êµì‚¬ì˜ í‰ê°€ ì—…ë¬´ë¥¼ ë•ëŠ” AI ë³´ì¡° ë„êµ¬ì…ë‹ˆë‹¤. 
                        ë‹¤ìŒ ì§€ì¹¨ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•˜ì—¬ "í‰ì–´(í‰ê°€ ë¬¸ì¥)"ë¥¼ ìƒì„±í•˜ì„¸ìš”.

                        [ì…ë ¥ëœ ì„±ì·¨ ê¸°ì¤€]
                        ${JSON.stringify(validStandards)}

                        [ìš”ì²­ ì‚¬í•­]
                        1. ê° ì„±ì·¨ ê¸°ì¤€ë³„ 4ë‹¨ê³„(ë§¤ìš° ì˜í•¨, ì˜í•¨, ë³´í†µ, ë…¸ë ¥ìš”í•¨) ìƒì„±.
                        2. ê°œìˆ˜: ë§¤ìš° ì˜í•¨(${counts.veryGood}), ì˜í•¨(${counts.good}), ë³´í†µ(${counts.average}), ë…¸ë ¥ìš”í•¨(${counts.needsEffort})
                        
                        [í•„ìˆ˜ ì œì•½ ì¡°ê±´ - **ë§ì¶¤ë²• ê²€ì‚¬ í•„ìˆ˜**]
                        1. **ì–´ë¯¸**: ë°˜ë“œì‹œ ëª…ì‚¬í˜•(ì˜ˆ: -í•¨., -ì„., -ê²ƒ.)ìœ¼ë¡œ ëë‚´ì„¸ìš”. ì„œìˆ í˜•(~í•©ë‹ˆë‹¤) ê¸ˆì§€.
                        2. **íŠ¹ìˆ˜ë¬¸ì**: ë”°ì˜´í‘œ, ê´„í˜¸ ë“± íŠ¹ìˆ˜ë¬¸ì ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€. ë¬¸ìì™€ ë§ˆì¹¨í‘œë§Œ ì‚¬ìš©.
                        3. **ë§ì¶¤ë²•**: "ê°•í•œ ë§ì¶¤ë²• ê·œì¹™"ì„ ì ìš©í•˜ì—¬ ë„ì–´ì“°ê¸°ì™€ ì˜¤íƒˆìë¥¼ ì™„ë²½í•˜ê²Œ êµì •í•˜ì„¸ìš”.
                        4. **ë‹¤ì–‘ì„±**: ë™ì¼ ë‹¨ì–´ ë°˜ë³µ íšŒí”¼, ë¬¸ì¥ êµ¬ì¡° ë‹¤ì–‘í™”.
                        
                        [ì¶œë ¥ í˜•ì‹: JSON Array]
                        [ { "standard": "...", "levels": { "veryGood": ["..."], "good": ["..."], "average": ["..."], "needsEffort": ["..."] } } ]
                    `;
                    const result = await callGemini(prompt);
                    setCommentResults(result);
                    setActiveTab(0);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // 2. í–‰ë°œ ìƒì„± í•¨ìˆ˜
            const generateBehavior = async () => {
                // ì²´í¬ëœ í•­ëª©ì´ ìˆëŠ” í•™ìƒë§Œ ë°ì´í„°ë¥¼ ì¶”ë¦¼ (ë˜ëŠ” ì „ì²´ ë³´ëƒ„)
                const studentData = students.map(s => ({
                    id: s.id,
                    name: s.name || `í•™ìƒ${s.id}`,
                    traits: Array.from(s.checks)
                }));

                setLoading(true);
                setError('');
                setBehaviorResults(null);

                try {
                    const prompt = `
                        ë‹¹ì‹ ì€ ë‹´ì„ êµì‚¬ë¡œì„œ í•™ìƒì˜ "í–‰ë™íŠ¹ì„± ë° ì¢…í•©ì˜ê²¬"ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
                        ì•„ë˜ í•™ìƒë³„ íŠ¹ì„± í‚¤ì›Œë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¤„ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

                        [í•™ìƒ ë°ì´í„°]
                        ${JSON.stringify(studentData)}

                        [ì‘ì„± ê·œì¹™ - ì—„ê²© ì¤€ìˆ˜]
                        1. **ë¶„ëŸ‰**: ê° í•™ìƒë‹¹ ì•½ ${targetBytes}ë°”ì´íŠ¸ ë‚´ì™¸ë¡œ ì‘ì„±í•˜ì„¸ìš”. (í•œê¸€ì€ ê¸€ìë‹¹ 2~3ë°”ì´íŠ¸ì´ë¯€ë¡œ, ëŒ€ëµ ${Math.floor(targetBytes / 2)}~${Math.floor(targetBytes / 1.5)}ê¸€ì ë‚´ì™¸)
                        2. **ë¬¸ì²´**: í•™ìƒì˜ íŠ¹ì„±ì„ ì˜ ë“œëŸ¬ë‚´ëŠ” ë¬¸ì¥ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•˜ì„¸ìš”.
                        3. **ê¸ˆì§€ ì‚¬í•­**: 
                           - **íŠ¹ìˆ˜ë¬¸ì ì‚¬ìš© ê¸ˆì§€**: ë”°ì˜´í‘œ(" '), ê´„í˜¸(( )), êº½ì‡  ë“± ì ˆëŒ€ ê¸ˆì§€. ì˜¤ì§ í•œê¸€, ìˆ«ì, ë°˜ì (,), ì˜¨ì (.)ë§Œ ì‚¬ìš© ê°€ëŠ¥.
                           - **ì™¸ë˜ì–´/ì˜ì–´ ê¸ˆì§€**: ìˆœìš°ë¦¬ë§ì´ë‚˜ í•œìì–´ ë“± í‘œì¤€ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
                        4. **ë§ì¶¤ë²•**: **"ê°•í•œ ë§ì¶¤ë²• ê·œì¹™"**ì„ ì ìš©í•˜ì„¸ìš”. ë„ì–´ì“°ê¸°, ë¬¸ë²• ì˜¤ë¥˜ê°€ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.
                        5. ë‚´ìš©: ì„ íƒëœ í‚¤ì›Œë“œ(í•™ìŠµ, ì„±ê²©, ì˜ˆì²´ëŠ¥)ì˜ ë‚´ìš©ì„ ëª¨ë‘ í¬í•¨í•˜ì—¬ ì¢…í•©ì ìœ¼ë¡œ ì„œìˆ í•˜ì„¸ìš”. í‚¤ì›Œë“œê°€ ì—†ëŠ” ê²½ìš° ê¸ì •ì ì¸ ì¼ë°˜ì  í•™êµ ìƒí™œ ëª¨ìŠµì„ ì„œìˆ í•˜ì„¸ìš”.

                        [ì¶œë ¥ í˜•ì‹: JSON Array]
                        [ { "id": 1, "name": "í•™ìƒì´ë¦„", "result": "ì‘ì„±ëœ ì¤„ê¸€..." }, ... ]
                    `;
                    const result = await callGemini(prompt);
                    setBehaviorResults(result);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen py-8 px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto">
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-3xl font-extrabold text-gray-900">AI êµì‚¬ ë³´ì¡° ë„êµ¬</h1>
                        <p className="text-gray-500 text-sm mt-1">í‰ì–´ ìƒì„± ë° í–‰ë™ë°œë‹¬ íŠ¹ì„± ì‘ì„± ë„ìš°ë¯¸</p>
                    </div>

                    {/* API Key Input */}
                    <div className="bg-white shadow-sm border border-gray-200 rounded-lg p-4 mb-6 flex flex-col sm:flex-row items-center gap-4">
                        <label className="font-bold text-gray-700 whitespace-nowrap">API Key ì…ë ¥</label>
                        <input
                            type="password"
                            value={apiKey}
                            onChange={(e) => setApiKey(e.target.value)}
                            placeholder="Google AI Studio API Key"
                            className="flex-1 w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                        />
                    </div>

                    {/* Navigation Tabs */}
                    <div className="flex mb-6 bg-white rounded-lg p-1 shadow-sm border border-gray-200 w-fit mx-auto">
                        <button
                            onClick={() => { setMode('comment'); setError(''); }}
                            className={`px-6 py-2 rounded-md font-bold transition ${mode === 'comment' ? 'bg-blue-600 text-white shadow' : 'text-gray-500 hover:bg-gray-100'}`}
                        >
                            í‰ì–´ ìƒì„±ê¸°
                        </button>
                        <button
                            onClick={() => { setMode('behavior'); setError(''); }}
                            className={`px-6 py-2 rounded-md font-bold transition ${mode === 'behavior' ? 'bg-green-600 text-white shadow' : 'text-gray-500 hover:bg-gray-100'}`}
                        >
                            í–‰ë°œ ìƒì„±ê¸°
                        </button>
                    </div>

                    {/* ERROR Display */}
                    {error && (
                        <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-sm whitespace-pre-line">
                            <p className="font-bold">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</p>
                            <p>{error}</p>
                        </div>
                    )}

                    {/* ================= MODE 1: í‰ì–´ ìƒì„±ê¸° ================= */}
                    {mode === 'comment' && (
                        <div className="animate-fade-in">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                {/* Left: Standards */}
                                <div className="lg:col-span-2 bg-white shadow rounded-lg p-6 border border-gray-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-lg text-gray-800">ì„±ì·¨ ê¸°ì¤€ ì…ë ¥</h3>
                                        <button onClick={addStandard} className="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200 font-bold">+ ì¶”ê°€</button>
                                    </div>
                                    <div className="space-y-3">
                                        {standards.map((std, i) => (
                                            <div key={i} className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={std}
                                                    onChange={(e) => handleStandardChange(i, e.target.value)}
                                                    placeholder="ì˜ˆ: ìì‹ ì˜ ê¿ˆì„ êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í•œë‹¤."
                                                    className="flex-1 p-2 border border-gray-300 rounded focus:border-blue-500 outline-none"
                                                />
                                                {standards.length > 1 && (
                                                    <button onClick={() => removeStandard(i)} className="text-red-500 hover:text-red-700 px-2">âœ•</button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                {/* Right: Settings */}
                                <div className="bg-white shadow rounded-lg p-6 border border-gray-200 h-fit">
                                    <h3 className="font-bold text-lg text-gray-800 mb-4">ìƒì„± ì„¤ì •</h3>
                                    <div className="space-y-3">
                                        {[
                                            {k:'veryGood', l:'ë§¤ìš° ì˜í•¨', c:'text-blue-600'},
                                            {k:'good', l:'ì˜í•¨', c:'text-green-600'},
                                            {k:'average', l:'ë³´í†µ', c:'text-yellow-600'},
                                            {k:'needsEffort', l:'ë…¸ë ¥ìš”í•¨', c:'text-orange-600'}
                                        ].map(lvl => (
                                            <div key={lvl.k} className="flex justify-between items-center">
                                                <span className={`font-medium ${lvl.c}`}>{lvl.l}</span>
                                                <div className="flex items-center gap-1">
                                                    <input 
                                                        type="number" value={counts[lvl.k]} 
                                                        onChange={(e)=>handleCountChange(lvl.k, e.target.value)}
                                                        className="w-16 p-1 border rounded text-right"
                                                    />
                                                    <span className="text-sm text-gray-500">ê°œ</span>
                                                </div>
                                            </div>
                                        ))}
                                        <div className="pt-3 border-t mt-3">
                                            <p className="text-xs text-gray-500">â€» ê°•í•œ ë§ì¶¤ë²• ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                onClick={generateComments}
                                disabled={loading}
                                className={`w-full py-3 rounded-lg text-white font-bold text-lg shadow transition ${loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'}`}
                            >
                                {loading ? <div className="flex justify-center items-center gap-2"><div className="loader"></div>ìƒì„± ì¤‘...</div> : 'í‰ì–´ ìƒì„±í•˜ê¸°'}
                            </button>

                            {/* Comment Results */}
                            {commentResults && (
                                <div className="mt-8 bg-white shadow-lg rounded-lg overflow-hidden border border-gray-200">
                                    <div className="flex overflow-x-auto bg-gray-50 border-b">
                                        {commentResults.map((r, i) => (
                                            <button
                                                key={i}
                                                onClick={() => setActiveTab(i)}
                                                className={`px-5 py-3 text-sm font-bold whitespace-nowrap ${activeTab === i ? 'bg-white border-t-2 border-blue-600 text-blue-700' : 'text-gray-500 hover:bg-gray-100'}`}
                                            >
                                                ì„±ì·¨ê¸°ì¤€ {i+1}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="p-6">
                                        <div className="bg-blue-50 p-3 rounded border border-blue-100 mb-6 text-sm text-blue-900 font-medium">
                                            {commentResults[activeTab].standard}
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {[
                                                {k:'veryGood', t:'ë§¤ìš° ì˜í•¨', bg:'bg-blue-50', b:'border-blue-200'},
                                                {k:'good', t:'ì˜í•¨', bg:'bg-green-50', b:'border-green-200'},
                                                {k:'average', t:'ë³´í†µ', bg:'bg-yellow-50', b:'border-yellow-200'},
                                                {k:'needsEffort', t:'ë…¸ë ¥ìš”í•¨', bg:'bg-orange-50', b:'border-orange-200'}
                                            ].map(sec => (
                                                <div key={sec.k} className={`border ${sec.b} rounded-lg overflow-hidden`}>
                                                    <div className={`${sec.bg} px-3 py-2 font-bold text-gray-700 text-sm border-b ${sec.b} flex justify-between`}>
                                                        <span>{sec.t}</span>
                                                        <span className="bg-white px-2 rounded-full border text-xs flex items-center">{commentResults[activeTab].levels[sec.k]?.length || 0}</span>
                                                    </div>
                                                    <ul className="p-3 space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
                                                        {commentResults[activeTab].levels[sec.k]?.map((s, idx) => (
                                                            <li key={idx} onClick={() => copyToClipboard(s)} className="text-sm p-2 hover:bg-gray-50 rounded cursor-pointer group flex">
                                                                <span className="flex-1 text-gray-700">{s}</span>
                                                                <span className="hidden group-hover:block text-xs text-gray-400 ml-1">ë³µì‚¬</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* ================= MODE 2: í–‰ë°œ ìƒì„±ê¸° ================= */}
                    {mode === 'behavior' && (
                        <div className="animate-fade-in">
                            {/* Controls */}
                            <div className="bg-white shadow rounded-lg p-6 mb-6 border border-gray-200">
                                <div className="flex flex-col md:flex-row gap-6 justify-between items-end">
                                    <div className="flex gap-6 w-full md:w-auto">
                                        <div>
                                            <label className="block font-bold text-gray-700 mb-1">í•™ìƒ ìˆ˜</label>
                                            <input 
                                                type="number" min="1" max="50"
                                                value={studentCount}
                                                onChange={handleStudentCountChange}
                                                className="w-24 p-2 border border-gray-300 rounded focus:border-green-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block font-bold text-gray-700 mb-1">ëª©í‘œ ë°”ì´íŠ¸(Bytes)</label>
                                            <input 
                                                type="number" step="100"
                                                value={targetBytes}
                                                onChange={(e) => setTargetBytes(parseInt(e.target.value) || 0)}
                                                className="w-32 p-2 border border-gray-300 rounded focus:border-green-500 outline-none"
                                            />
                                        </div>
                                    </div>
                                    <div className="text-right text-xs text-gray-500 w-full md:w-auto">
                                        <p>* íŠ¹ìˆ˜ë¬¸ì/ì™¸ë˜ì–´ ì œì™¸</p>
                                        <p>* ê°•í•œ ë§ì¶¤ë²• ê·œì¹™ ì ìš©</p>
                                    </div>
                                </div>
                            </div>

                            {/* Student List */}
                            <div className="space-y-4 mb-8">
                                {students.map((student, sIdx) => (
                                    <div key={student.id} className="bg-white shadow-sm border border-gray-200 rounded-lg overflow-hidden">
                                        <div className="bg-gray-50 px-4 py-3 border-b border-gray-200 flex flex-wrap items-center gap-3">
                                            <span className="font-bold text-gray-600 w-12">No.{student.id}</span>
                                            <input 
                                                type="text" 
                                                placeholder="í•™ìƒ ì´ë¦„ (ì„ íƒ)" 
                                                value={student.name}
                                                onChange={(e) => updateStudentName(sIdx, e.target.value)}
                                                className="p-1 px-2 border border-gray-300 rounded text-sm w-32 focus:border-green-500 outline-none"
                                            />
                                            <div className="flex-1 text-right text-xs text-blue-600 font-medium">
                                                ì„ íƒë¨: {student.checks.size}ê°œ
                                            </div>
                                        </div>
                                        
                                        <div className="p-4">
                                            {/* Categories Grid */}
                                            <div className="grid grid-cols-1 md:grid-cols-12 gap-4">
                                                {/* í•™ìŠµ (3 cols) */}
                                                <div className="md:col-span-3 border-r md:border-r-0 lg:border-r border-gray-100 pr-2">
                                                    <h4 className="font-bold text-sm text-gray-800 mb-2 border-b pb-1">ğŸ“š í•™ìŠµ</h4>
                                                    <div className="flex flex-col gap-2">
                                                        {BEHAVIOR_CATEGORIES["í•™ìŠµ"].map(trait => (
                                                            <label key={trait} className="checkbox-wrapper cursor-pointer flex items-center group">
                                                                <input type="checkbox" className="hidden" 
                                                                    checked={student.checks.has(trait)}
                                                                    onChange={() => toggleCheck(sIdx, trait)}
                                                                />
                                                                <div className="w-full text-sm px-3 py-2 rounded border border-gray-200 text-gray-600 group-hover:border-green-300 transition text-center">
                                                                    {trait.replace('í•™ìŠµ(', '').replace(')', '')}
                                                                </div>
                                                            </label>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* ì„±ê²© (7 cols) */}
                                                <div className="md:col-span-7 border-r md:border-r-0 lg:border-r border-gray-100 pr-2 px-2">
                                                    <h4 className="font-bold text-sm text-gray-800 mb-2 border-b pb-1">ğŸ˜Š ì„±ê²©/ì¸ì„±</h4>
                                                    <div className="grid grid-cols-3 sm:grid-cols-4 gap-2">
                                                        {BEHAVIOR_CATEGORIES["ì„±ê²©"].map(trait => (
                                                            <label key={trait} className="checkbox-wrapper cursor-pointer flex items-center group">
                                                                <input type="checkbox" className="hidden" 
                                                                    checked={student.checks.has(trait)}
                                                                    onChange={() => toggleCheck(sIdx, trait)}
                                                                />
                                                                <div className="w-full text-sm px-2 py-2 rounded border border-gray-200 text-gray-600 group-hover:border-green-300 transition text-center truncate">
                                                                    {trait}
                                                                </div>
                                                            </label>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* ì˜ˆì²´ëŠ¥ (2 cols) */}
                                                <div className="md:col-span-2 pl-2">
                                                    <h4 className="font-bold text-sm text-gray-800 mb-2 border-b pb-1">ğŸ¨ ì˜ˆì²´ëŠ¥</h4>
                                                    <div className="flex flex-col gap-2">
                                                        {BEHAVIOR_CATEGORIES["ì˜ˆì²´ëŠ¥"].map(trait => (
                                                            <label key={trait} className="checkbox-wrapper cursor-pointer flex items-center group">
                                                                <input type="checkbox" className="hidden" 
                                                                    checked={student.checks.has(trait)}
                                                                    onChange={() => toggleCheck(sIdx, trait)}
                                                                />
                                                                <div className="w-full text-sm px-3 py-2 rounded border border-gray-200 text-gray-600 group-hover:border-green-300 transition text-center">
                                                                    {trait}
                                                                </div>
                                                            </label>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <button
                                onClick={generateBehavior}
                                disabled={loading}
                                className={`w-full py-3 rounded-lg text-white font-bold text-lg shadow transition ${loading ? 'bg-gray-400' : 'bg-green-600 hover:bg-green-700'}`}
                            >
                                {loading ? <div className="flex justify-center items-center gap-2"><div className="loader"></div>ìƒì„± ì¤‘...</div> : 'í–‰ë°œ ìƒì„±í•˜ê¸°'}
                            </button>

                            {/* Behavior Results */}
                            {behaviorResults && (
                                <div className="mt-8 grid gap-6">
                                    {behaviorResults.map((res, i) => (
                                        <div key={i} className="bg-white shadow rounded-lg border border-gray-200 overflow-hidden">
                                            <div className="bg-green-50 px-4 py-3 border-b border-green-100 flex justify-between items-center">
                                                <span className="font-bold text-green-900">
                                                    {res.name || `í•™ìƒ ${res.id}`} 
                                                    <span className="text-xs font-normal text-green-700 ml-2">
                                                        (ì•½ {new TextEncoder().encode(res.result).length} Bytes)
                                                    </span>
                                                </span>
                                                <button onClick={() => copyToClipboard(res.result)} className="text-xs bg-white border border-green-200 px-2 py-1 rounded text-green-700 hover:bg-green-100">
                                                    ë³µì‚¬
                                                </button>
                                            </div>
                                            <div className="p-4 text-gray-700 text-sm leading-relaxed whitespace-pre-wrap">
                                                {res.result}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>