<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ì–´ ìƒì„±ê¸°</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles -->
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f3f4f6; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            // State ê´€ë¦¬
            const [apiKey, setApiKey] = useState('');
            const [standards, setStandards] = useState(['']); // ì„±ì·¨ ê¸°ì¤€ ëª©ë¡
            const [counts, setCounts] = useState({
                veryGood: 3,
                good: 3,
                average: 3,
                needsEffort: 3
            });
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(false);
            const [activeTab, setActiveTab] = useState(0); // í˜„ì¬ ë³´ê³  ìˆëŠ” ì„±ì·¨ ê¸°ì¤€ íƒ­
            const [error, setError] = useState('');

            // ì„±ì·¨ ê¸°ì¤€ ì¶”ê°€
            const addStandard = () => {
                setStandards([...standards, '']);
            };

            // ì„±ì·¨ ê¸°ì¤€ ì‚­ì œ
            const removeStandard = (index) => {
                const newStandards = standards.filter((_, i) => i !== index);
                setStandards(newStandards.length ? newStandards : ['']);
            };

            // ì„±ì·¨ ê¸°ì¤€ ì…ë ¥ ë³€ê²½
            const handleStandardChange = (index, value) => {
                const newStandards = [...standards];
                newStandards[index] = value;
                setStandards(newStandards);
            };

            // ê°œìˆ˜ ë³€ê²½ í•¸ë“¤ëŸ¬ (ìµœëŒ€ 40ê°œ ì œí•œ)
            const handleCountChange = (level, value) => {
                let num = parseInt(value) || 0;
                if (num > 40) num = 40;
                if (num < 0) num = 0;
                setCounts({ ...counts, [level]: num });
            };

            // ìƒì„±í•˜ê¸° ë²„íŠ¼ í´ë¦­
            const generateComments = async () => {
                if (!apiKey) {
                    setError('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                const validStandards = standards.filter(s => s.trim() !== '');
                if (validStandards.length === 0) {
                    setError('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì„±ì·¨ ê¸°ì¤€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                setLoading(true);
                setError('');
                setResults(null);

                try {
                    const prompt = `
                        ë‹¹ì‹ ì€ êµì‚¬ì˜ í‰ê°€ ì—…ë¬´ë¥¼ ë•ëŠ” AI ë³´ì¡° ë„êµ¬ì…ë‹ˆë‹¤. 
                        ë‹¤ìŒ ì§€ì¹¨ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•˜ì—¬ í•™ìƒì˜ ìƒí™œê¸°ë¡ë¶€ ë˜ëŠ” í†µì§€í‘œì— ë“¤ì–´ê°ˆ "í‰ì–´(í‰ê°€ ë¬¸ì¥)"ë¥¼ ìƒì„±í•˜ì„¸ìš”.

                        [ì…ë ¥ëœ ì„±ì·¨ ê¸°ì¤€ ëª©ë¡]
                        ${JSON.stringify(validStandards)}

                        [ìš”ì²­ ì‚¬í•­]
                        1. ê° ì„±ì·¨ ê¸°ì¤€ë³„ë¡œ ë‹¤ìŒ 4ë‹¨ê³„ ìˆ˜ì¤€ì˜ ë¬¸ì¥ì„ ìƒì„±í•˜ì„¸ìš”: "ë§¤ìš° ì˜í•¨", "ì˜í•¨", "ë³´í†µ", "ë…¸ë ¥ìš”í•¨".
                        2. ê° ë‹¨ê³„ë³„ ìƒì„± ê°œìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
                           - ë§¤ìš° ì˜í•¨: ${counts.veryGood}ê°œ
                           - ì˜í•¨: ${counts.good}ê°œ
                           - ë³´í†µ: ${counts.average}ê°œ
                           - ë…¸ë ¥ìš”í•¨: ${counts.needsEffort}ê°œ
                        
                        [í•„ìˆ˜ ì œì•½ ì¡°ê±´]
                        1. **ì–´ë¯¸**: ë°˜ë“œì‹œ ëª…ì‚¬í˜•ìœ¼ë¡œ ëë‚´ì„¸ìš”. (ì˜ˆ: "-í•¨.", "-ì„.", "-ê²ƒ.", "-ë³´ì„.") "~í•©ë‹ˆë‹¤", "~í•´ìš”" ê°™ì€ ì„œìˆ í˜• ì–´ë¯¸ëŠ” ì ˆëŒ€ ê¸ˆì§€ì…ë‹ˆë‹¤.
                        2. **íŠ¹ìˆ˜ë¬¸ì ê¸ˆì§€**: ë”°ì˜´í‘œ(" '), ê´„í˜¸(( )), êº½ì‡ (< >) ë“± íŠ¹ìˆ˜ë¬¸ìë¥¼ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ì˜¤ì§ ë¬¸ìì™€ ë§ˆì¹¨í‘œ(.)ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
                        3. **ì°½ì˜ì„± ë° ë‹¤ì–‘ì„±**: 
                           - ì…ë ¥ëœ ì„±ì·¨ ê¸°ì¤€ì˜ í•µì‹¬ ë§¥ë½ì€ ìœ ì§€í•˜ë˜, ë¬¸ì¥ êµ¬ì¡°ì™€ ì–´íœ˜ë¥¼ ë‹¤ì–‘í•˜ê²Œ ë³€ê²½í•˜ì„¸ìš”.
                           - ë™ì¼í•œ ë‹¨ì–´ì˜ ë°˜ë³µì„ í”¼í•˜ê³  ìœ ì˜ì–´ë¥¼ ì ê·¹ í™œìš©í•˜ì„¸ìš”.
                           - ë‹¨ìˆœíˆ ìˆ˜ì‹ì–´(ë§¤ìš°, ì¡°ê¸ˆ ë“±)ë§Œ ë°”ê¾¸ëŠ” ê²ƒì„ ì§€ì–‘í•˜ê³ , ê´€ì°°ëœ í–‰ë™ì´ë‚˜ ì„±ì·¨ì˜ ì–‘ìƒì„ ë‹¤ë¥´ê²Œ í‘œí˜„í•˜ì„¸ìš”.
                        4. **ì¶œë ¥ í˜•ì‹**: ë°˜ë“œì‹œ ì•„ë˜ì™€ ê°™ì€ ìˆœìˆ˜í•œ JSON Array í˜•ì‹ìœ¼ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.

                        [JSON ì¶œë ¥ ìŠ¤í‚¤ë§ˆ]
                        [
                          {
                            "standard": "String",
                            "levels": {
                              "veryGood": ["String"],
                              "good": ["String"],
                              "average": ["String"],
                              "needsEffort": ["String"]
                            }
                          }
                        ]
                    `;

                    // Gemini 1.5 Flash ì‚¬ìš© (ì•ˆì •ì„± ë° JSON ëª¨ë“œ ì§€ì›)
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }],
                            // ì•ˆì „ ì„¤ì • ì™„í™” (í•„í„°ë§ìœ¼ë¡œ ì¸í•œ ë¹ˆ ì‘ë‹µ ë°©ì§€)
                            safetySettings: [
                                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                            ],
                            generationConfig: {
                                temperature: 0.9,
                                maxOutputTokens: 8192,
                                responseMimeType: "application/json" // JSON ì‘ë‹µ ê°•ì œ
                            }
                        })
                    });

                    if (!response.ok) {
                        let errorMsg = 'API ìš”ì²­ ì‹¤íŒ¨';
                        try {
                            const errData = await response.json();
                            errorMsg = errData.error?.message || errorMsg;
                        } catch (e) {
                            const textError = await response.text();
                            errorMsg = `ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ (${response.status}): ${textError.slice(0, 100)}`;
                        }
                        throw new Error(errorMsg);
                    }

                    const data = await response.json();
                    
                    // ì‘ë‹µ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                    if (!data.candidates || data.candidates.length === 0) {
                         throw new Error('AIê°€ ì‘ë‹µì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ë¹ˆ ì‘ë‹µ)');
                    }

                    const candidate = data.candidates[0];
                    if (candidate.finishReason !== "STOP") {
                        // ì•ˆì „ ë¬¸ì œ ë“±ìœ¼ë¡œ ì¤‘ë‹¨ëœ ê²½ìš°
                        console.warn("Finish Reason:", candidate.finishReason);
                    }

                    let rawText = candidate.content?.parts?.[0]?.text;
                    
                    if (!rawText) {
                        throw new Error('AI ì‘ë‹µì— í…ìŠ¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    
                    const jsonResult = JSON.parse(rawText);
                    setResults(jsonResult);
                    setActiveTab(0);

                } catch (err) {
                    console.error(err);
                    setError('ì˜¤ë¥˜ ë°œìƒ: ' + err.message + '\n(API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€, ì‚¬ìš©ëŸ‰ í•œë„ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.)');
                } finally {
                    setLoading(false);
                }
            };

            // í´ë¦½ë³´ë“œ ë³µì‚¬
            const copyToClipboard = (text) => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            };

            return (
                <div className="min-h-screen py-10 px-4 sm:px-6 lg:px-8 max-w-5xl mx-auto">
                    {/* Header */}
                    <div className="text-center mb-10">
                        <h1 className="text-4xl font-extrabold text-gray-900 mb-2">í‰ì–´ ìƒì„±ê¸°</h1>
                        <p className="text-gray-600">ì„±ì·¨ ê¸°ì¤€ì„ ì…ë ¥í•˜ë©´ ë‹¤ì–‘í•œ ìˆ˜ì¤€ë³„ í‰ê°€ ë¬¸ì¥ì„ ìƒì„±í•´ì¤ë‹ˆë‹¤.</p>
                    </div>

                    {/* API Key Input */}
                    <div className="bg-white shadow rounded-lg p-6 mb-6">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                            Google Gemini API Key
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" className="ml-2 text-blue-500 hover:text-blue-700 text-xs underline">(í‚¤ ë°œê¸‰ë°›ê¸°)</a>
                        </label>
                        <input
                            type="password"
                            value={apiKey}
                            onChange={(e) => setApiKey(e.target.value)}
                            placeholder="AI Studioì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            className="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                        />
                    </div>

                    {/* Settings Section (Inputs & Counts) */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        
                        {/* Left: Standards Input */}
                        <div className="lg:col-span-2 bg-white shadow rounded-lg p-6">
                            <div className="flex justify-between items-center mb-4">
                                <label className="text-lg font-bold text-gray-900">ì„±ì·¨ ê¸°ì¤€ ì…ë ¥</label>
                                <button 
                                    onClick={addStandard}
                                    className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-md text-sm font-medium transition flex items-center"
                                >
                                    <span className="mr-1">+</span> ì„±ì·¨ ê¸°ì¤€ ì¶”ê°€í•˜ê¸°
                                </button>
                            </div>
                            
                            <div className="space-y-3">
                                {standards.map((std, index) => (
                                    <div key={index} className="flex gap-2">
                                        <input
                                            type="text"
                                            value={std}
                                            onChange={(e) => handleStandardChange(index, e.target.value)}
                                            placeholder={`ì„±ì·¨ ê¸°ì¤€ ${index + 1} (ì˜ˆ: ìì‹ ì˜ ê¿ˆì„ êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í•œë‹¤)`}
                                            className="flex-1 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                                        />
                                        {standards.length > 1 && (
                                            <button 
                                                onClick={() => removeStandard(index)}
                                                className="bg-red-100 text-red-600 px-3 rounded-md hover:bg-red-200"
                                                title="ì‚­ì œ"
                                            >
                                                âœ•
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Right: Counts Input */}
                        <div className="bg-white shadow rounded-lg p-6">
                            <h3 className="text-lg font-bold text-gray-900 mb-4">ìˆ˜ì¤€ë³„ ìƒì„± ê°œìˆ˜</h3>
                            <div className="space-y-4">
                                {[
                                    { id: 'veryGood', label: 'ë§¤ìš° ì˜í•¨', color: 'text-blue-600' },
                                    { id: 'good', label: 'ì˜í•¨', color: 'text-green-600' },
                                    { id: 'average', label: 'ë³´í†µ', color: 'text-yellow-600' },
                                    { id: 'needsEffort', label: 'ë…¸ë ¥ìš”í•¨', color: 'text-orange-600' }
                                ].map((level) => (
                                    <div key={level.id} className="flex justify-between items-center">
                                        <label className={`font-medium ${level.color}`}>{level.label}</label>
                                        <div className="flex items-center">
                                            <input
                                                type="number"
                                                min="0"
                                                max="40"
                                                value={counts[level.id]}
                                                onChange={(e) => handleCountChange(level.id, e.target.value)}
                                                className="w-20 p-2 text-right border border-gray-300 rounded-md focus:ring-blue-500 outline-none"
                                            />
                                            <span className="ml-2 text-gray-500 text-sm">ê°œ</span>
                                        </div>
                                    </div>
                                ))}
                                <p className="text-xs text-gray-400 text-right mt-2">* ìˆ˜ì¤€ ë‹¹ ìµœëŒ€ 40ê°œ</p>
                            </div>
                        </div>
                    </div>

                    {/* Generate Button */}
                    <button
                        onClick={generateComments}
                        disabled={loading}
                        className={`w-full py-4 rounded-lg text-white font-bold text-lg shadow-md transition transform active:scale-95 mb-8 ${
                            loading ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'
                        }`}
                    >
                        {loading ? (
                            <div className="flex items-center justify-center gap-2">
                                <div className="loader w-6 h-6 border-2"></div>
                                <span>AIê°€ ì°½ì˜ì ì¸ ë¬¸ì¥ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</span>
                            </div>
                        ) : (
                            'í‰ì–´ ìƒì„±í•˜ê¸°'
                        )}
                    </button>

                    {/* Error Message */}
                    {error && (
                        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 whitespace-pre-line" role="alert">
                            <p>{error}</p>
                        </div>
                    )}

                    {/* Results Section */}
                    {results && (
                        <div className="bg-white shadow-lg rounded-lg overflow-hidden min-h-[500px]">
                            {/* Tabs for Standards */}
                            <div className="flex overflow-x-auto bg-gray-50 border-b border-gray-200">
                                {results.map((res, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => setActiveTab(idx)}
                                        className={`px-6 py-4 text-sm font-medium whitespace-nowrap focus:outline-none transition-colors duration-200 ${
                                            activeTab === idx
                                                ? 'bg-white border-t-4 border-blue-500 text-blue-700'
                                                : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'
                                        }`}
                                    >
                                        ì„±ì·¨ ê¸°ì¤€ {idx + 1}
                                    </button>
                                ))}
                            </div>

                            {/* Content for Active Tab */}
                            <div className="p-6">
                                <div className="mb-6 p-4 bg-blue-50 rounded-md border border-blue-100">
                                    <span className="font-bold text-blue-800 mr-2">[ì„±ì·¨ ê¸°ì¤€]</span>
                                    <span className="text-gray-800">{results[activeTab].standard}</span>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {[
                                        { key: 'veryGood', title: 'ğŸŒŸ ë§¤ìš° ì˜í•¨', bg: 'bg-blue-50', border: 'border-blue-200' },
                                        { key: 'good', title: 'âœ… ì˜í•¨', bg: 'bg-green-50', border: 'border-green-200' },
                                        { key: 'average', title: 'ğŸ‘Œ ë³´í†µ', bg: 'bg-yellow-50', border: 'border-yellow-200' },
                                        { key: 'needsEffort', title: 'ğŸŒ± ë…¸ë ¥ìš”í•¨', bg: 'bg-orange-50', border: 'border-orange-200' }
                                    ].map((section) => (
                                        <div key={section.key} className={`rounded-lg border ${section.border} overflow-hidden`}>
                                            <div className={`${section.bg} px-4 py-3 font-bold text-gray-700 border-b ${section.border} flex justify-between items-center`}>
                                                <span>{section.title}</span>
                                                <span className="text-xs text-gray-500 bg-white px-2 py-1 rounded-full border">
                                                    {results[activeTab].levels[section.key]?.length || 0}ê°œ
                                                </span>
                                            </div>
                                            <div className="p-4 max-h-60 overflow-y-auto custom-scrollbar">
                                                <ul className="space-y-2">
                                                    {results[activeTab].levels[section.key]?.map((sentence, sIdx) => (
                                                        <li key={sIdx} className="text-sm text-gray-700 flex group cursor-pointer hover:bg-gray-100 p-1 rounded" onClick={() => copyToClipboard(sentence)}>
                                                            <span className="flex-1">{sentence}</span>
                                                            <span className="hidden group-hover:inline-block text-xs text-gray-400 ml-2">ë³µì‚¬</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>