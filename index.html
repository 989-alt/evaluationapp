<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI êµì‚¬ ë³´ì¡° ë„êµ¬ (í‰ì–´ & í–‰ë°œ & ì°½ì²´)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles -->
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f3f4f6; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
        /* Checkbox Visuals for 3-state */
        .trait-box {
            transition: all 0.2s;
        }
        /* State 1: Positive (Blue) */
        .trait-box.state-1 {
            background-color: #dbeafe; /* blue-100 */
            border-color: #3b82f6; /* blue-500 */
            color: #1e40af; /* blue-800 */
        }
        /* State 2: Needs Improvement (Orange) */
        .trait-box.state-2 {
            background-color: #ffedd5; /* orange-100 */
            border-color: #f97316; /* orange-500 */
            color: #9a3412; /* orange-800 */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ë°ì´í„° ì •ì˜ ---
        const BEHAVIOR_CATEGORIES = {
            "í•™ìŠµ": ["í•™ìŠµ(ìš°ìˆ˜)", "í•™ìŠµ(ë°œì „ê°€ëŠ¥)", "í•™ìŠµ(ì œì•ˆ)"],
            "ì„±ê²©": ["ëˆê¸°", "ì˜ˆì˜", "ë°°ë ¤", "ë…ì„œ", "êµìš°ê´€ê³„", "ê·œì¹™ì¤€ìˆ˜", "ì†Œì‹ ", "ë´‰ì‚¬", "ê°ˆë“±ê´€ë¦¬", "ì±…ì„ê°", "ë°œí‘œ", "í˜‘ë ¥", "ìœ ë¨¸"],
            "ì˜ˆì²´ëŠ¥": ["ìŒì•…", "ë¯¸ìˆ ", "ì²´ìœ¡"]
        };

        const App = () => {
            // --- Common State ---
            const [mode, setMode] = useState('comment'); // 'comment' | 'behavior' | 'creative'
            const [apiKey, setApiKey] = useState('');
            
            // ëª¨ë¸ ê´€ë ¨ State
            const [model, setModel] = useState('gemini-1.5-flash'); 
            const [modelList, setModelList] = useState([
                { name: 'models/gemini-1.5-flash', displayName: 'gemini-1.5-flash (ê¸°ë³¸)' },
                { name: 'models/gemini-1.5-flash-002', displayName: 'gemini-1.5-flash-002 (ìµœì‹ )' },
                { name: 'models/gemini-1.5-pro', displayName: 'gemini-1.5-pro (ê³ ì„±ëŠ¥)' },
                { name: 'models/gemini-pro', displayName: 'gemini-pro (êµ¬ë²„ì „)' }
            ]);
            const [isFetchingModels, setIsFetchingModels] = useState(false);

            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            // --- Comment Gen State (í‰ì–´) ---
            const [standards, setStandards] = useState(['']);
            const [counts, setCounts] = useState({ veryGood: 3, good: 3, average: 3, needsEffort: 3 });
            const [commentResults, setCommentResults] = useState(null);
            const [activeTab, setActiveTab] = useState(0);

            // --- Behavior Gen State (í–‰ë°œ) ---
            const [studentCount, setStudentCount] = useState(1);
            const [students, setStudents] = useState([{ id: 1, name: '', checks: new Map() }]);
            const [targetBytes, setTargetBytes] = useState(500); 
            const [behaviorResults, setBehaviorResults] = useState(null);

            // --- Creative Gen State (ì°½ì²´) ---
            const [creativeInputs, setCreativeInputs] = useState([{ text: '', count: 3 }]);
            const [creativeResults, setCreativeResults] = useState(null);

            // --- Helpers ---
            const copyToClipboard = (text) => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            };

            // --- Logic: Comment Generator ---
            const addStandard = () => setStandards([...standards, '']);
            const removeStandard = (idx) => {
                const newStds = standards.filter((_, i) => i !== idx);
                setStandards(newStds.length ? newStds : ['']);
            };
            const handleStandardChange = (idx, val) => {
                const newStds = [...standards];
                newStds[idx] = val;
                setStandards(newStds);
            };
            const handleCountChange = (level, val) => {
                let num = parseInt(val) || 0;
                setCounts({ ...counts, [level]: Math.min(40, Math.max(0, num)) });
            };

            // --- Logic: Behavior Generator ---
            const handleStudentCountChange = (e) => {
                const count = Math.max(1, Math.min(50, parseInt(e.target.value) || 1));
                setStudentCount(count);
                
                setStudents(prev => {
                    const newArr = [...prev];
                    if (count > prev.length) {
                        for (let i = prev.length; i < count; i++) {
                            newArr.push({ id: i + 1, name: '', checks: new Map() });
                        }
                    } else {
                        return newArr.slice(0, count);
                    }
                    return newArr;
                });
            };

            const toggleCheck = (studentIndex, trait) => {
                setStudents(prev => {
                    const newArr = [...prev];
                    const student = { ...newArr[studentIndex] };
                    const newChecks = new Map(student.checks);
                    
                    const currentVal = newChecks.get(trait) || 0;
                    const nextVal = (currentVal + 1) % 3;

                    if (nextVal === 0) newChecks.delete(trait);
                    else newChecks.set(trait, nextVal);
                    
                    student.checks = newChecks;
                    newArr[studentIndex] = student;
                    return newArr;
                });
            };

            const updateStudentName = (idx, val) => {
                setStudents(prev => {
                    const newArr = [...prev];
                    newArr[idx] = { ...newArr[idx], name: val };
                    return newArr;
                });
            };

            // --- Logic: Creative Generator ---
            const addCreativeInput = () => setCreativeInputs([...creativeInputs, { text: '', count: 3 }]);
            const removeCreativeInput = (idx) => {
                const newInputs = creativeInputs.filter((_, i) => i !== idx);
                setCreativeInputs(newInputs.length ? newInputs : [{ text: '', count: 3 }]);
            };
            const handleCreativeChange = (idx, field, val) => {
                const newInputs = [...creativeInputs];
                if (field === 'count') {
                    newInputs[idx][field] = Math.min(20, Math.max(1, parseInt(val) || 1));
                } else {
                    newInputs[idx][field] = val;
                }
                setCreativeInputs(newInputs);
            };

            // --- API Model Fetching ---
            const fetchAvailableModels = async () => {
                if (!apiKey) {
                    setError("API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                setIsFetchingModels(true);
                setError("");
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    if (!response.ok) throw new Error("ëª¨ë¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    
                    const data = await response.json();
                    if (data.models) {
                        const validModels = data.models.filter(m => 
                            m.supportedGenerationMethods && 
                            m.supportedGenerationMethods.includes("generateContent")
                        ).map(m => ({
                            name: m.name,
                            displayName: m.displayName || m.name
                        }));

                        validModels.sort((a, b) => {
                            if (a.name.includes('1.5') && !b.name.includes('1.5')) return -1;
                            if (!a.name.includes('1.5') && b.name.includes('1.5')) return 1;
                            return 0;
                        });

                        setModelList(validModels);
                        if (validModels.length > 0) {
                            setModel(validModels[0].name.replace('models/', '')); 
                            alert(`ì´ ${validModels.length}ê°œì˜ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                        }
                    }
                } catch (err) {
                    setError(`ëª¨ë¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${err.message}`);
                } finally {
                    setIsFetchingModels(false);
                }
            };

            // --- API Call Functions ---
            const callGemini = async (prompt) => {
                if (!apiKey) throw new Error('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                
                const cleanModelName = model.startsWith('models/') ? model.split('/')[1] : model;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${cleanModelName}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        safetySettings: [
                            { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                        ],
                        generationConfig: {
                            temperature: 0.9,
                            maxOutputTokens: 8192,
                            responseMimeType: "application/json"
                        }
                    })
                });

                if (!response.ok) {
                    const errData = await response.json().catch(() => ({}));
                    throw new Error(errData.error?.message || `ì„œë²„ ì˜¤ë¥˜ (${response.status}) - ëª¨ë¸ëª…ì´ë‚˜ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                }

                const data = await response.json();
                const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!rawText) throw new Error('AI ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');

                return JSON.parse(rawText);
            };

            // 1. í‰ì–´ ìƒì„± í•¨ìˆ˜
            const generateComments = async () => {
                const validStandards = standards.filter(s => s.trim() !== '');
                if (validStandards.length === 0) {
                    setError('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì„±ì·¨ ê¸°ì¤€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                setLoading(true);
                setError('');
                setCommentResults(null);

                try {
                    const prompt = `
                        ë‹¹ì‹ ì€ êµì‚¬ì˜ í‰ê°€ ì—…ë¬´ë¥¼ ë•ëŠ” AI ë³´ì¡° ë„êµ¬ì…ë‹ˆë‹¤. 
                        ë‹¤ìŒ ì§€ì¹¨ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•˜ì—¬ "í‰ì–´(í‰ê°€ ë¬¸ì¥)"ë¥¼ ìƒì„±í•˜ì„¸ìš”.

                        [ì…ë ¥ëœ ì„±ì·¨ ê¸°ì¤€ ëª©ë¡]
                        ${JSON.stringify(validStandards)}

                        [ìƒì„± ê·œì¹™ - **ì—„ê²© ì¤€ìˆ˜**]
                        1. ì…ë ¥ëœ **ê°ê°ì˜ ì„±ì·¨ ê¸°ì¤€ë§ˆë‹¤** ì•„ë˜ ê°œìˆ˜ë§Œí¼ ë¬¸ì¥ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
                        2. **ê° ì„±ì·¨ ê¸°ì¤€ ë‹¹** ìƒì„± ê°œìˆ˜:
                           - "ë§¤ìš° ì˜í•¨": ${counts.veryGood}ê°œ
                           - "ì˜í•¨": ${counts.good}ê°œ
                           - "ë³´í†µ": ${counts.average}ê°œ
                           - "ë…¸ë ¥ìš”í•¨": ${counts.needsEffort}ê°œ
                        
                        [í•„ìˆ˜ ì œì•½ ì¡°ê±´ - **ë§ì¶¤ë²• ê²€ì‚¬ í•„ìˆ˜**]
                        1. **ì–´ë¯¸**: ë°˜ë“œì‹œ ëª…ì‚¬í˜•(ì˜ˆ: -í•¨., -ì„., -ê²ƒ.)ìœ¼ë¡œ ëë‚´ì„¸ìš”. ì„œìˆ í˜•(~í•©ë‹ˆë‹¤) ê¸ˆì§€.
                        2. **íŠ¹ìˆ˜ë¬¸ì**: ë”°ì˜´í‘œ, ê´„í˜¸ ë“± íŠ¹ìˆ˜ë¬¸ì ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€. ë¬¸ìì™€ ë§ˆì¹¨í‘œë§Œ ì‚¬ìš©.
                        3. **ë§ì¶¤ë²•**: "ê°•í•œ ë§ì¶¤ë²• ê·œì¹™"ì„ ì ìš©í•˜ì—¬ ë„ì–´ì“°ê¸°ì™€ ì˜¤íƒˆìë¥¼ ì™„ë²½í•˜ê²Œ êµì •í•˜ì„¸ìš”.
                        4. **ë‹¤ì–‘ì„±**: ë™ì¼ ë‹¨ì–´ ë°˜ë³µ íšŒí”¼, ë¬¸ì¥ êµ¬ì¡° ë‹¤ì–‘í™”.
                        
                        [ì¶œë ¥ í˜•ì‹: JSON Array]
                        [ 
                          { 
                            "standard": "ì²« ë²ˆì§¸ ì„±ì·¨ê¸°ì¤€ ë‚´ìš©", 
                            "levels": { 
                              "veryGood": ["..."], 
                              "good": ["..."], 
                              "average": ["..."], 
                              "needsEffort": ["..."] 
                            } 
                          },
                          ...
                        ]
                    `;
                    const result = await callGemini(prompt);
                    setCommentResults(result);
                    setActiveTab(0);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // 2. í–‰ë°œ ìƒì„± í•¨ìˆ˜
            const generateBehavior = async () => {
                const studentData = students.map(s => {
                    const traits = [];
                    s.checks.forEach((status, name) => {
                        traits.push({ 
                            name: name, 
                            status: status === 1 ? 'ê¸ì •(ìš°ìˆ˜)' : 'ì§€ë„í•„ìš”(ë¶€ì¡±í•¨/ê°œì„ í•„ìš”)' 
                        });
                    });
                    return {
                        id: s.id,
                        name: s.name || `í•™ìƒ${s.id}`,
                        traits: traits
                    };
                });

                setLoading(true);
                setError('');
                setBehaviorResults(null);

                try {
                    const prompt = `
                        ë‹¹ì‹ ì€ ë‹´ì„ êµì‚¬ë¡œì„œ í•™ìƒì˜ "í–‰ë™íŠ¹ì„± ë° ì¢…í•©ì˜ê²¬(í–‰ë°œ)"ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
                        ì•„ë˜ í•™ìƒë³„ íŠ¹ì„± ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¤„ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

                        [í•™ìƒ ë°ì´í„°]
                        ${JSON.stringify(studentData)}

                        [ì‘ì„± ê·œì¹™ - **ì—„ê²© ì¤€ìˆ˜**]
                        1. **ì£¼ì–´ ìƒëµ**: "í•™ìƒ1ì€", "OOOëŠ”"ê³¼ ê°™ì€ ì£¼ì–´ë¥¼ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ë°”ë¡œ íŠ¹ì„± ì„œìˆ ë¶€í„° ì‹œì‘í•˜ì„¸ìš”.
                        2. **ì–´ë¯¸**: ë¬¸ì¥ì˜ ëì€ ë°˜ë“œì‹œ **"-í•¨."** ë˜ëŠ” **"-ì„."** ì´ ë‘ ê°€ì§€ ì¤‘ í•˜ë‚˜ë¡œë§Œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤.
                           - ì˜ëª»ëœ ì˜ˆ: -í•¨, -ì„ (ë§ˆì¹¨í‘œ ì—†ìŒ), -ê²ƒì„., -ë³´ì„., -í•©ë‹ˆë‹¤.
                           - ì˜¬ë°”ë¥¸ ì˜ˆ: ì„±ì‹¤íˆ ìˆ˜í–‰í•¨., ìš°ìˆ˜í•œ ëª¨ìŠµì„ ë³´ì„.
                        3. **ë¶„ëŸ‰**: ê° í•™ìƒë‹¹ ì•½ ${targetBytes}ë°”ì´íŠ¸ ë‚´ì™¸.
                        4. **íŠ¹ì„± ë°˜ì˜ ë¡œì§**:
                           - ìƒíƒœê°€ **'ê¸ì •(ìš°ìˆ˜)'**ì¸ í•­ëª©: í•´ë‹¹ íŠ¹ì„±ì´ ìš°ìˆ˜í•˜ë‹¤ëŠ” ì¹­ì°¬ ë¬¸êµ¬ ì‘ì„±.
                           - ìƒíƒœê°€ **'ì§€ë„í•„ìš”(ë¶€ì¡±í•¨/ê°œì„ í•„ìš”)'**ì¸ í•­ëª©: ë¶€ì¡±í•˜ë‚˜ ê°œì„ í•˜ê³  ìˆë‹¤ëŠ” ê¸ì •ì  ë³€í™” ê°€ëŠ¥ì„± í¬í•¨.
                           - **'í•™ìŠµ(ì œì•ˆ)'** í•­ëª©: í•™ìŠµì— ëŒ€í•œ ë…¸ë ¥ê³¼ ë³´ì™„ í•„ìš” ëª…ì‹œ.
                        5. **íŠ¹ìˆ˜ë¬¸ì ì œí•œ**: **ì˜¨ì (.)ê³¼ ë°˜ì (,)**ì„ ì œì™¸í•œ ê·¸ ì–´ë–¤ íŠ¹ìˆ˜ë¬¸ì(ë”°ì˜´í‘œ, ê´„í˜¸ ë“±)ë„ ì‚¬ìš© ê¸ˆì§€.
                        6. **ì™¸ë˜ì–´/ì˜ì–´ ê¸ˆì§€**.
                        7. **ë§ì¶¤ë²•**: "ê°•í•œ ë§ì¶¤ë²• ê·œì¹™" ì ìš©.

                        [ì¶œë ¥ í˜•ì‹: JSON Array]
                        [ { "id": 1, "name": "í•™ìƒì´ë¦„", "result": "ì‘ì„±ëœ ì¤„ê¸€..." }, ... ]
                    `;
                    const result = await callGemini(prompt);
                    setBehaviorResults(result);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // 3. ì°½ì²´ ìƒì„± í•¨ìˆ˜
            const generateCreative = async () => {
                const validInputs = creativeInputs.filter(item => item.text.trim() !== '');
                if (validInputs.length === 0) {
                    setError('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                setLoading(true);
                setError('');
                setCreativeResults(null);

                try {
                    const prompt = `
                        ë‹¹ì‹ ì€ êµì‚¬ì˜ í•™êµìƒí™œê¸°ë¡ë¶€ ì‘ì„±ì„ ë•ëŠ” AIì…ë‹ˆë‹¤.
                        ì…ë ¥ëœ ë¬¸ì¥(íŠ¹ê¸°ì‚¬í•­ ì˜ˆì‹œ)ì„ ë°”íƒ•ìœ¼ë¡œ, ë¹„ìŠ·í•œ ë§¥ë½ì´ì§€ë§Œ í‘œí˜„ì´ ë‹¤ë¥¸ ë¬¸ì¥ë“¤ì„ ìƒì„±í•´ì£¼ì„¸ìš”.

                        [ì…ë ¥ ë°ì´í„°]
                        ${JSON.stringify(validInputs)}

                        [ì‘ì„± ê·œì¹™ - **ì—„ê²© ì¤€ìˆ˜**]
                        1. **ì–´ë¯¸**: ë¬¸ì¥ì˜ ëì€ ë°˜ë“œì‹œ **"-í•¨."** ë˜ëŠ” **"-ì„."** ì´ ë‘ ê°€ì§€ ì¤‘ í•˜ë‚˜ë¡œë§Œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤.
                           - ì˜ˆ: "í™œë™ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•¨.", "ë¦¬ë”ì‹­ì´ ë‹ë³´ì„."
                        2. **ìˆ˜ëŸ‰**: ê° ì…ë ¥ ë¬¸ì¥ì— ëŒ€í•´, ìš”ì²­ëœ 'count' ê°œìˆ˜ë§Œí¼ì˜ ë³€í˜• ë¬¸ì¥ì„ ìƒì„±í•˜ì„¸ìš”.
                        3. **ë‚´ìš©**: ì›ë¬¸ì´ ê°€ì§„ ê¸ì •ì ì¸ ë§¥ë½ê³¼ í•µì‹¬ í‚¤ì›Œë“œëŠ” ìœ ì§€í•˜ë˜, ì„œìˆ ì–´ì™€ í‘œí˜„ ë°©ì‹ì„ ë‹¤ì–‘í•˜ê²Œ ë°”ê¾¸ì„¸ìš”.
                        4. **íŠ¹ìˆ˜ë¬¸ì ì œí•œ**: **ì˜¨ì (.)ê³¼ ë°˜ì (,)**ì„ ì œì™¸í•œ íŠ¹ìˆ˜ë¬¸ì ì‚¬ìš© ê¸ˆì§€.
                        5. **ë§ì¶¤ë²•**: "ê°•í•œ ë§ì¶¤ë²• ê·œì¹™" ì ìš©.

                        [ì¶œë ¥ í˜•ì‹: JSON Array]
                        [
                          {
                            "original": "ì…ë ¥ëœ ì›ë¬¸",
                            "variations": ["ë³€í˜• ë¬¸ì¥ 1...", "ë³€í˜• ë¬¸ì¥ 2...", ...]
                          },
                          ...
                        ]
                    `;
                    const result = await callGemini(prompt);
                    setCreativeResults(result);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen py-8 px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto">
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-3xl font-extrabold text-gray-900">AI êµì‚¬ ë³´ì¡° ë„êµ¬</h1>
                        <p className="text-gray-500 text-sm mt-1">í‰ì–´, í–‰ë°œ, ì°½ì²´ íŠ¹ê¸°ì‚¬í•­ ì‘ì„± ë„ìš°ë¯¸</p>
                    </div>

                    {/* API Key & Model Selection Zone */}
                    <div className="bg-white shadow-sm border border-gray-200 rounded-lg p-4 mb-6">
                        <div className="flex flex-col sm:flex-row items-end gap-4">
                            <div className="flex-1 w-full flex flex-col">
                                <label className="font-bold text-gray-700 text-sm mb-1">API Key ì…ë ¥</label>
                                <input
                                    type="password"
                                    value={apiKey}
                                    onChange={(e) => setApiKey(e.target.value)}
                                    placeholder="Google AI Studio API Key"
                                    className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                                />
                            </div>
                            <button 
                                onClick={fetchAvailableModels}
                                disabled={isFetchingModels || !apiKey}
                                className={`whitespace-nowrap px-4 py-2 rounded text-sm font-bold border border-blue-200 text-blue-700 hover:bg-blue-50 transition h-10 mb-[1px] ${!apiKey ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                {isFetchingModels ? <div className="loader w-4 h-4 border-2 border-blue-500"></div> : 'ğŸ” ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸ ì¡°íšŒ'}
                            </button>
                            <div className="w-full sm:w-64 flex flex-col">
                                <label className="font-bold text-gray-700 text-sm mb-1">AI ëª¨ë¸ ì„ íƒ</label>
                                <select 
                                    value={model} 
                                    onChange={(e) => setModel(e.target.value)}
                                    className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white"
                                >
                                    {modelList.map((m, idx) => (
                                        <option key={idx} value={m.name.replace('models/', '')}>{m.displayName}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>

                    {/* Navigation Tabs */}
                    <div className="flex mb-6 bg-white rounded-lg p-1 shadow-sm border border-gray-200 w-fit mx-auto">
                        <button
                            onClick={() => { setMode('comment'); setError(''); }}
                            className={`px-6 py-2 rounded-md font-bold transition ${mode === 'comment' ? 'bg-blue-600 text-white shadow' : 'text-gray-500 hover:bg-gray-100'}`}
                        >
                            í‰ì–´ ìƒì„±ê¸°
                        </button>
                        <button
                            onClick={() => { setMode('behavior'); setError(''); }}
                            className={`px-6 py-2 rounded-md font-bold transition ${mode === 'behavior' ? 'bg-green-600 text-white shadow' : 'text-gray-500 hover:bg-gray-100'}`}
                        >
                            í–‰ë°œ ìƒì„±ê¸°
                        </button>
                        <button
                            onClick={() => { setMode('creative'); setError(''); }}
                            className={`px-6 py-2 rounded-md font-bold transition ${mode === 'creative' ? 'bg-purple-600 text-white shadow' : 'text-gray-500 hover:bg-gray-100'}`}
                        >
                            ì°½ì²´ ìƒì„±ê¸°
                        </button>
                    </div>

                    {/* ERROR Display */}
                    {error && (
                        <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-sm whitespace-pre-line">
                            <p className="font-bold">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</p>
                            <p>{error}</p>
                        </div>
                    )}

                    {/* ================= MODE 1: í‰ì–´ ìƒì„±ê¸° ================= */}
                    {mode === 'comment' && (
                        <div className="animate-fade-in">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                {/* Left: Standards */}
                                <div className="lg:col-span-2 bg-white shadow rounded-lg p-6 border border-gray-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-lg text-gray-800">ì„±ì·¨ ê¸°ì¤€ ì…ë ¥</h3>
                                        <button onClick={addStandard} className="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200 font-bold">+ ì¶”ê°€</button>
                                    </div>
                                    <div className="space-y-3">
                                        {standards.map((std, i) => (
                                            <div key={i} className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={std}
                                                    onChange={(e) => handleStandardChange(i, e.target.value)}
                                                    placeholder="ì˜ˆ: ìì‹ ì˜ ê¿ˆì„ êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í•œë‹¤."
                                                    className="flex-1 p-2 border border-gray-300 rounded focus:border-blue-500 outline-none"
                                                />
                                                {standards.length > 1 && (
                                                    <button onClick={() => removeStandard(i)} className="text-red-500 hover:text-red-700 px-2">âœ•</button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                {/* Right: Settings */}
                                <div className="bg-white shadow rounded-lg p-6 border border-gray-200 h-fit">
                                    <h3 className="font-bold text-lg text-gray-800 mb-4">ìƒì„± ì„¤ì •</h3>
                                    <div className="space-y-3">
                                        {[
                                            {k:'veryGood', l:'ë§¤ìš° ì˜í•¨', c:'text-blue-600'},
                                            {k:'good', l:'ì˜í•¨', c:'text-green-600'},
                                            {k:'average', l:'ë³´í†µ', c:'text-yellow-600'},
                                            {k:'needsEffort', l:'ë…¸ë ¥ìš”í•¨', c:'text-orange-600'}
                                        ].map(lvl => (
                                            <div key={lvl.k} className="flex justify-between items-center">
                                                <span className={`font-medium ${lvl.c}`}>{lvl.l}</span>
                                                <div className="flex items-center gap-1">
                                                    <input 
                                                        type="number" value={counts[lvl.k]} 
                                                        onChange={(e)=>handleCountChange(lvl.k, e.target.value)}
                                                        className="w-16 p-1 border rounded text-right"
                                                    />
                                                    <span className="text-sm text-gray-500">ê°œ</span>
                                                </div>
                                            </div>
                                        ))}
                                        <div className="pt-3 border-t mt-3">
                                            <p className="text-xs text-gray-500">â€» ê°•í•œ ë§ì¶¤ë²• ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                onClick={generateComments}
                                disabled={loading}
                                className={`w-full py-3 rounded-lg text-white font-bold text-lg shadow transition ${loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'}`}
                            >
                                {loading ? <div className="flex justify-center items-center gap-2"><div className="loader"></div>ìƒì„± ì¤‘...</div> : 'í‰ì–´ ìƒì„±í•˜ê¸°'}
                            </button>

                            {/* Comment Results */}
                            {commentResults && (
                                <div className="mt-8 bg-white shadow-lg rounded-lg overflow-hidden border border-gray-200">
                                    <div className="flex overflow-x-auto bg-gray-50 border-b">
                                        {commentResults.map((r, i) => (
                                            <button
                                                key={i}
                                                onClick={() => setActiveTab(i)}
                                                className={`px-5 py-3 text-sm font-bold whitespace-nowrap ${activeTab === i ? 'bg-white border-t-2 border-blue-600 text-blue-700' : 'text-gray-500 hover:bg-gray-100'}`}
                                            >
                                                ì„±ì·¨ê¸°ì¤€ {i+1}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="p-6">
                                        <div className="bg-blue-50 p-3 rounded border border-blue-100 mb-6 text-sm text-blue-900 font-medium">
                                            {commentResults[activeTab].standard}
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {[
                                                {k:'veryGood', t:'ë§¤ìš° ì˜í•¨', bg:'bg-blue-50', b:'border-blue-200'},
                                                {k:'good', t:'ì˜í•¨', bg:'bg-green-50', b:'border-green-200'},
                                                {k:'average', t:'ë³´í†µ', bg:'bg-yellow-50', b:'border-yellow-200'},
                                                {k:'needsEffort', t:'ë…¸ë ¥ìš”í•¨', bg:'bg-orange-50', b:'border-orange-200'}
                                            ].map(sec => (
                                                <div key={sec.k} className={`border ${sec.b} rounded-lg overflow-hidden`}>
                                                    <div className={`${sec.bg} px-3 py-2 font-bold text-gray-700 text-sm border-b ${sec.b} flex justify-between`}>
                                                        <span>{sec.t}</span>
                                                        <span className="bg-white px-2 rounded-full border text-xs flex items-center">{commentResults[activeTab].levels[sec.k]?.length || 0}</span>
                                                    </div>
                                                    <ul className="p-3 space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
                                                        {commentResults[activeTab].levels[sec.k]?.map((s, idx) => (
                                                            <li key={idx} onClick={() => copyToClipboard(s)} className="text-sm p-2 hover:bg-gray-50 rounded cursor-pointer group flex">
                                                                <span className="flex-1 text-gray-700">{s}</span>
                                                                <span className="hidden group-hover:block text-xs text-gray-400 ml-1">ë³µì‚¬</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* ================= MODE 2: í–‰ë°œ ìƒì„±ê¸° ================= */}
                    {mode === 'behavior' && (
                        <div className="animate-fade-in">
                            {/* Controls */}
                            <div className="bg-white shadow rounded-lg p-6 mb-6 border border-gray-200">
                                <div className="flex flex-col md:flex-row gap-6 justify-between items-end">
                                    <div className="flex gap-6 w-full md:w-auto">
                                        <div>
                                            <label className="block font-bold text-gray-700 mb-1">í•™ìƒ ìˆ˜</label>
                                            <input 
                                                type="number" min="1" max="50"
                                                value={studentCount}
                                                onChange={handleStudentCountChange}
                                                className="w-24 p-2 border border-gray-300 rounded focus:border-green-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block font-bold text-gray-700 mb-1">ëª©í‘œ ë°”ì´íŠ¸(Bytes)</label>
                                            <input 
                                                type="number" step="100"
                                                value={targetBytes}
                                                onChange={(e) => setTargetBytes(parseInt(e.target.value) || 0)}
                                                className="w-32 p-2 border border-gray-300 rounded focus:border-green-500 outline-none"
                                            />
                                        </div>
                                    </div>
                                    <div className="text-right text-xs text-gray-500 w-full md:w-auto">
                                        <p>* <span className="text-blue-600 font-bold">1ë²ˆ í´ë¦­(íŒŒë‘)</span>: ê¸ì •/ìš°ìˆ˜</p>
                                        <p>* <span className="text-orange-600 font-bold">2ë²ˆ í´ë¦­(ì£¼í™©)</span>: ë¶€ì¡±/ì§€ë„í•„ìš” (ê°œì„ ë…¸ë ¥ í¬í•¨)</p>
                                        <p>* íŠ¹ìˆ˜ë¬¸ì/ì™¸ë˜ì–´ ì œì™¸, ëª…ì‚¬í˜• ì–´ë¯¸ ì‚¬ìš©</p>
                                    </div>
                                </div>
                            </div>

                            {/* Student List */}
                            <div className="space-y-4 mb-8">
                                {students.map((student, sIdx) => (
                                    <div key={student.id} className="bg-white shadow-sm border border-gray-200 rounded-lg overflow-hidden">
                                        <div className="bg-gray-50 px-4 py-3 border-b border-gray-200 flex flex-wrap items-center gap-3">
                                            <span className="font-bold text-gray-600 w-12">No.{student.id}</span>
                                            <input 
                                                type="text" 
                                                placeholder="í•™ìƒ ì´ë¦„ (ì„ íƒ)" 
                                                value={student.name}
                                                onChange={(e) => updateStudentName(sIdx, e.target.value)}
                                                className="p-1 px-2 border border-gray-300 rounded text-sm w-32 focus:border-green-500 outline-none"
                                            />
                                            <div className="flex-1 text-right text-xs text-blue-600 font-medium">
                                                ì„ íƒë¨: {student.checks.size}ê°œ
                                            </div>
                                        </div>
                                        
                                        <div className="p-4">
                                            {/* Categories Grid */}
                                            <div className="grid grid-cols-1 md:grid-cols-12 gap-4">
                                                {/* í•™ìŠµ (3 cols) */}
                                                <div className="md:col-span-3 border-r md:border-r-0 lg:border-r border-gray-100 pr-2">
                                                    <h4 className="font-bold text-sm text-gray-800 mb-2 border-b pb-1">ğŸ“š í•™ìŠµ</h4>
                                                    <div className="flex flex-col gap-2">
                                                        {BEHAVIOR_CATEGORIES["í•™ìŠµ"].map(trait => {
                                                            const checkState = student.checks.get(trait) || 0;
                                                            return (
                                                                <div key={trait} 
                                                                    onClick={() => toggleCheck(sIdx, trait)}
                                                                    className={`trait-box cursor-pointer w-full text-sm px-3 py-2 rounded border border-gray-200 text-center select-none
                                                                        ${checkState === 1 ? 'state-1' : ''}
                                                                        ${checkState === 2 ? 'state-2' : ''}
                                                                        ${checkState === 0 ? 'text-gray-600 hover:bg-gray-50' : ''}
                                                                    `}
                                                                >
                                                                    {trait.replace('í•™ìŠµ(', '').replace(')', '')}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                {/* ì„±ê²© (7 cols) */}
                                                <div className="md:col-span-7 border-r md:border-r-0 lg:border-r border-gray-100 pr-2 px-2">
                                                    <h4 className="font-bold text-sm text-gray-800 mb-2 border-b pb-1">ğŸ˜Š ì„±ê²©/ì¸ì„±</h4>
                                                    <div className="grid grid-cols-3 sm:grid-cols-4 gap-2">
                                                        {BEHAVIOR_CATEGORIES["ì„±ê²©"].map(trait => {
                                                            const checkState = student.checks.get(trait) || 0;
                                                            return (
                                                                <div key={trait} 
                                                                    onClick={() => toggleCheck(sIdx, trait)}
                                                                    className={`trait-box cursor-pointer w-full text-sm px-2 py-2 rounded border border-gray-200 text-center truncate select-none
                                                                        ${checkState === 1 ? 'state-1' : ''}
                                                                        ${checkState === 2 ? 'state-2' : ''}
                                                                        ${checkState === 0 ? 'text-gray-600 hover:bg-gray-50' : ''}
                                                                    `}
                                                                >
                                                                    {trait}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                {/* ì˜ˆì²´ëŠ¥ (2 cols) */}
                                                <div className="md:col-span-2 pl-2">
                                                    <h4 className="font-bold text-sm text-gray-800 mb-2 border-b pb-1">ğŸ¨ ì˜ˆì²´ëŠ¥</h4>
                                                    <div className="flex flex-col gap-2">
                                                        {BEHAVIOR_CATEGORIES["ì˜ˆì²´ëŠ¥"].map(trait => {
                                                            const checkState = student.checks.get(trait) || 0;
                                                            return (
                                                                <div key={trait} 
                                                                    onClick={() => toggleCheck(sIdx, trait)}
                                                                    className={`trait-box cursor-pointer w-full text-sm px-3 py-2 rounded border border-gray-200 text-center select-none
                                                                        ${checkState === 1 ? 'state-1' : ''}
                                                                        ${checkState === 2 ? 'state-2' : ''}
                                                                        ${checkState === 0 ? 'text-gray-600 hover:bg-gray-50' : ''}
                                                                    `}
                                                                >
                                                                    {trait}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <button
                                onClick={generateBehavior}
                                disabled={loading}
                                className={`w-full py-3 rounded-lg text-white font-bold text-lg shadow transition ${loading ? 'bg-gray-400' : 'bg-green-600 hover:bg-green-700'}`}
                            >
                                {loading ? <div className="flex justify-center items-center gap-2"><div className="loader"></div>ìƒì„± ì¤‘...</div> : 'í–‰ë°œ ìƒì„±í•˜ê¸°'}
                            </button>

                            {/* Behavior Results */}
                            {behaviorResults && (
                                <div className="mt-8 grid gap-6">
                                    {behaviorResults.map((res, i) => (
                                        <div key={i} className="bg-white shadow rounded-lg border border-gray-200 overflow-hidden">
                                            <div className="bg-green-50 px-4 py-3 border-b border-green-100 flex justify-between items-center">
                                                <span className="font-bold text-green-900">
                                                    {res.name || `í•™ìƒ ${res.id}`} 
                                                    <span className="text-xs font-normal text-green-700 ml-2">
                                                        (ì•½ {new TextEncoder().encode(res.result).length} Bytes)
                                                    </span>
                                                </span>
                                                <button onClick={() => copyToClipboard(res.result)} className="text-xs bg-white border border-green-200 px-2 py-1 rounded text-green-700 hover:bg-green-100">
                                                    ë³µì‚¬
                                                </button>
                                            </div>
                                            <div className="p-4 text-gray-700 text-sm leading-relaxed whitespace-pre-wrap">
                                                {res.result}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}

                    {/* ================= MODE 3: ì°½ì²´ ìƒì„±ê¸° ================= */}
                    {mode === 'creative' && (
                        <div className="animate-fade-in">
                            <div className="bg-white shadow rounded-lg p-6 mb-6 border border-gray-200">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-lg text-gray-800">ì°½ì²´ íŠ¹ê¸°ì‚¬í•­ ì…ë ¥</h3>
                                    <button onClick={addCreativeInput} className="text-sm bg-purple-100 text-purple-700 px-3 py-1 rounded hover:bg-purple-200 font-bold">+ ë¬¸ì¥ ì¶”ê°€</button>
                                </div>
                                
                                <div className="space-y-4">
                                    {creativeInputs.map((input, idx) => (
                                        <div key={idx} className="flex flex-col sm:flex-row gap-3 items-start sm:items-center bg-gray-50 p-3 rounded border border-gray-200">
                                            <div className="flex-1 w-full">
                                                <input
                                                    type="text"
                                                    value={input.text}
                                                    onChange={(e) => handleCreativeChange(idx, 'text', e.target.value)}
                                                    placeholder="ì˜ˆ: í•™êµ ì¶•ì œì—ì„œ ë¶€ìŠ¤ ìš´ì˜ì„ ì£¼ë„ì ìœ¼ë¡œ ìˆ˜í–‰í•¨."
                                                    className="w-full p-2 border border-gray-300 rounded focus:border-purple-500 outline-none"
                                                />
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <span className="text-sm font-medium text-gray-600 whitespace-nowrap">ìƒì„± ê°œìˆ˜:</span>
                                                <input
                                                    type="number"
                                                    value={input.count}
                                                    onChange={(e) => handleCreativeChange(idx, 'count', e.target.value)}
                                                    className="w-16 p-2 border border-gray-300 rounded focus:border-purple-500 outline-none text-right"
                                                    min="1" max="20"
                                                />
                                                <span className="text-sm text-gray-500">ê°œ</span>
                                            </div>
                                            {creativeInputs.length > 1 && (
                                                <button 
                                                    onClick={() => removeCreativeInput(idx)} 
                                                    className="text-red-500 hover:text-red-700 p-2"
                                                    title="ì‚­ì œ"
                                                >
                                                    âœ•
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-4 text-right text-xs text-gray-500">
                                    <p>* ì–´ë¯¸ëŠ” "-í•¨.", "-ì„."ìœ¼ë¡œ ê³ ì •ë©ë‹ˆë‹¤.</p>
                                    <p>* ê°•í•œ ë§ì¶¤ë²• ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤.</p>
                                </div>
                            </div>

                            <button
                                onClick={generateCreative}
                                disabled={loading}
                                className={`w-full py-3 rounded-lg text-white font-bold text-lg shadow transition ${loading ? 'bg-gray-400' : 'bg-purple-600 hover:bg-purple-700'}`}
                            >
                                {loading ? <div className="flex justify-center items-center gap-2"><div className="loader"></div>ìƒì„± ì¤‘...</div> : 'ìœ ì‚¬ ë¬¸ì¥ ìƒì„±í•˜ê¸°'}
                            </button>

                            {/* Creative Results */}
                            {creativeResults && (
                                <div className="mt-8 space-y-6">
                                    {creativeResults.map((item, idx) => (
                                        <div key={idx} className="bg-white shadow rounded-lg border border-gray-200 overflow-hidden">
                                            <div className="bg-purple-50 px-4 py-3 border-b border-purple-100">
                                                <h4 className="font-bold text-purple-900 text-sm mb-1">[ì›ë¬¸]</h4>
                                                <p className="text-gray-700 text-sm">{item.original}</p>
                                            </div>
                                            <div className="p-4">
                                                <h4 className="font-bold text-gray-800 text-sm mb-3">âœ¨ ìƒì„±ëœ ë³€í˜• ë¬¸ì¥ ({item.variations.length}ê°œ)</h4>
                                                <ul className="space-y-2">
                                                    {item.variations.map((sent, sIdx) => (
                                                        <li key={sIdx} onClick={() => copyToClipboard(sent)} className="text-sm p-3 bg-gray-50 hover:bg-purple-50 rounded border border-gray-100 cursor-pointer group flex transition">
                                                            <span className="flex-1 text-gray-700">{sent}</span>
                                                            <span className="hidden group-hover:block text-xs text-purple-400 ml-2 font-medium">ë³µì‚¬</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>